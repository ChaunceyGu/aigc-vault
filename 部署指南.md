# AI ç»˜å›¾èµ„äº§å½’æ¡£ç³»ç»Ÿ - éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### 1. æœåŠ¡å™¨è¦æ±‚

**æœ€ä½é…ç½®ï¼š**
- CPU: 2 æ ¸
- å†…å­˜: 4GB
- å­˜å‚¨: 20GBï¼ˆæ ¹æ®å›¾ç‰‡æ•°é‡è°ƒæ•´ï¼‰
- ç³»ç»Ÿ: Ubuntu 20.04+ / CentOS 7+ / Windows Server

**æ¨èé…ç½®ï¼š**
- CPU: 4 æ ¸
- å†…å­˜: 8GB
- å­˜å‚¨: 50GB+
- SSD å­˜å‚¨ï¼ˆæå‡æ•°æ®åº“æ€§èƒ½ï¼‰

### 2. è½¯ä»¶ä¾èµ–

- **Python**: 3.11+ 
- **Node.js**: 18+
- **PostgreSQL**: 12+
- **Nginx**: 1.18+ ï¼ˆå¯é€‰ï¼Œç”¨äºåå‘ä»£ç†ï¼‰
- **RustFS/S3**: å·²é…ç½®å¹¶è¿è¡Œ

---

## ğŸ”§ åç«¯éƒ¨ç½²

### æ­¥éª¤ 1: å‡†å¤‡æœåŠ¡å™¨ç¯å¢ƒ

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£… Python 3.11+
sudo apt install python3.11 python3.11-venv python3-pip -y

# å®‰è£… PostgreSQL
sudo apt install postgresql postgresql-contrib -y

# å®‰è£… Nginxï¼ˆå¯é€‰ï¼‰
sudo apt install nginx -y
```

### æ­¥éª¤ 2: é…ç½® PostgreSQL

```bash
# åˆ‡æ¢åˆ° postgres ç”¨æˆ·
sudo -u postgres psql

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
CREATE DATABASE aigc_vault;
CREATE USER aigc_user WITH PASSWORD 'your_secure_password';
GRANT ALL PRIVILEGES ON DATABASE aigc_vault TO aigc_user;

# é€€å‡º
\q
```

### æ­¥éª¤ 3: éƒ¨ç½²åç«¯ä»£ç 

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /opt/aigc-vault
sudo chown $USER:$USER /opt/aigc-vault
cd /opt/aigc-vault

# å…‹éš†ä»£ç ï¼ˆæˆ–ä¸Šä¼ ä»£ç ï¼‰
# git clone <your-repo> backend
# æˆ–ç›´æ¥ä¸Šä¼ ä»£ç åˆ° backend ç›®å½•

cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3.11 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install --upgrade pip
pip install -r requirements.txt

# åˆå§‹åŒ–æ•°æ®åº“
python scripts/init_db.py
```

### æ­¥éª¤ 4: é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd backend
cat > .env << EOF
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://aigc_user:your_secure_password@localhost:5432/aigc_vault

# RustFS/S3 é…ç½®
RUSTFS_ENDPOINT_URL=http://192.168.31.3:9900
RUSTFS_ACCESS_KEY=your_access_key
RUSTFS_SECRET_KEY=your_secret_key
RUSTFS_BUCKET=aigcvault
RUSTFS_REGION=us-east-1
RUSTFS_USE_SSL=false

# CORS é…ç½®
CORS_ORIGINS=http://localhost:5173,https://yourdomain.com

# å…¶ä»–é…ç½®
LOG_LEVEL=INFO
EOF
```

**âš ï¸ é‡è¦ï¼š** 
- ä¿®æ”¹æ•°æ®åº“å¯†ç 
- ä¿®æ”¹ RustFS é…ç½®
- ä¿®æ”¹ CORS_ORIGINS ä¸ºå®é™…çš„å‰ç«¯åŸŸå

### æ­¥éª¤ 5: ä½¿ç”¨ systemd ç®¡ç†æœåŠ¡

åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo cat > /etc/systemd/system/aigc-backend.service << EOF
[Unit]
Description=AIGC Asset Vault Backend API
After=network.target postgresql.service

[Service]
Type=simple
User=your_username
WorkingDirectory=/opt/aigc-vault/backend
Environment="PATH=/opt/aigc-vault/backend/venv/bin"
ExecStart=/opt/aigc-vault/backend/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
# é‡æ–°åŠ è½½ systemd
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start aigc-backend

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable aigc-backend

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status aigc-backend

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u aigc-backend -f
```

---

## ğŸ¨ å‰ç«¯éƒ¨ç½²

### æ­¥éª¤ 1: æ„å»ºå‰ç«¯

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æ„å»ºäº§ç‰©åœ¨ dist/ ç›®å½•
```

### æ­¥éª¤ 2: é…ç½® Nginx

åˆ›å»º Nginx é…ç½®ï¼š

```bash
sudo cat > /etc/nginx/sites-available/aigc-vault << EOF
server {
    listen 80;
    server_name yourdomain.com;  # ä¿®æ”¹ä¸ºä½ çš„åŸŸå

    # å‰ç«¯é™æ€æ–‡ä»¶
    root /opt/aigc-vault/frontend/dist;
    index index.html;

    # API ä»£ç†åˆ°åç«¯
    location /api {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
        
        # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
        client_max_body_size 100M;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }

    # å‰ç«¯è·¯ç”±
    location / {
        try_files \$uri \$uri/ /index.html;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
EOF
```

å¯ç”¨é…ç½®ï¼š

```bash
sudo ln -s /etc/nginx/sites-available/aigc-vault /etc/nginx/sites-enabled/
sudo nginx -t  # æµ‹è¯•é…ç½®
sudo systemctl restart nginx
```

### æ­¥éª¤ 3: é…ç½® HTTPSï¼ˆæ¨èï¼‰

ä½¿ç”¨ Let's Encrypt å…è´¹ SSL è¯ä¹¦ï¼š

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx -y

# è·å–è¯ä¹¦
sudo certbot --nginx -d yourdomain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

## ğŸ” å®‰å…¨é…ç½®

### 1. é˜²ç«å¢™é…ç½®

```bash
# å…è®¸ SSH (22)
sudo ufw allow 22/tcp

# å…è®¸ HTTP/HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable
```

### 2. æ•°æ®åº“å®‰å…¨

```bash
# ç¼–è¾‘ PostgreSQL é…ç½®
sudo nano /etc/postgresql/*/main/postgresql.conf

# è®¾ç½®ï¼š
# listen_addresses = 'localhost'  # ä»…æœ¬åœ°ç›‘å¬
# ssl = on  # å¯ç”¨ SSL

# é‡å¯ PostgreSQL
sudo systemctl restart postgresql
```

### 3. ç¯å¢ƒå˜é‡å®‰å…¨

- âœ… ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ° Git
- âœ… ä½¿ç”¨å¼ºå¯†ç 
- âœ… å®šæœŸæ›´æ¢å¯†é’¥
- âœ… é™åˆ¶æ•°æ®åº“è®¿é—®æƒé™

---

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### æŸ¥çœ‹åç«¯æ—¥å¿—

```bash
# systemd æ—¥å¿—
sudo journalctl -u aigc-backend -f

# æˆ–è€…æŸ¥çœ‹åº”ç”¨æ—¥å¿—æ–‡ä»¶ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
tail -f /var/log/aigc-vault/backend.log
```

### æŸ¥çœ‹ Nginx æ—¥å¿—

```bash
# è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/access.log

# é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### æ•°æ®åº“ç›‘æ§

```bash
# è¿æ¥æ•°æ®åº“
sudo -u postgres psql aigc_vault

# æŸ¥çœ‹è¡¨å¤§å°
SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### æ›´æ–°åç«¯

```bash
cd /opt/aigc-vault/backend

# æ‹‰å–æœ€æ–°ä»£ç 
git pull  # æˆ–ä¸Šä¼ æ–°ä»£ç 

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# æ›´æ–°ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœæœ‰ï¼‰
# python scripts/migrate.py

# é‡å¯æœåŠ¡
sudo systemctl restart aigc-backend
```

### æ›´æ–°å‰ç«¯

```bash
cd /opt/aigc-vault/frontend

# æ‹‰å–æœ€æ–°ä»£ç 
git pull  # æˆ–ä¸Šä¼ æ–°ä»£ç 

# å®‰è£…ä¾èµ–
npm install

# æ„å»º
npm run build

# é‡å¯ Nginx
sudo systemctl restart nginx
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### åç«¯æ— æ³•å¯åŠ¨

1. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š
   ```bash
   sudo systemctl status aigc-backend
   ```

2. æŸ¥çœ‹æ—¥å¿—ï¼š
   ```bash
   sudo journalctl -u aigc-backend -n 50
   ```

3. æ£€æŸ¥ç«¯å£å ç”¨ï¼š
   ```bash
   sudo netstat -tlnp | grep 8000
   ```

4. æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š
   ```bash
   cd /opt/aigc-vault/backend
   source venv/bin/activate
   python scripts/verify_db.py
   python scripts/verify_rustfs.py
   ```

### å‰ç«¯æ— æ³•è®¿é—®

1. æ£€æŸ¥ Nginx çŠ¶æ€ï¼š
   ```bash
   sudo systemctl status nginx
   ```

2. æ£€æŸ¥ Nginx é…ç½®ï¼š
   ```bash
   sudo nginx -t
   ```

3. æ£€æŸ¥æ–‡ä»¶æƒé™ï¼š
   ```bash
   ls -la /opt/aigc-vault/frontend/dist
   ```

### æ•°æ®åº“è¿æ¥å¤±è´¥

1. æ£€æŸ¥ PostgreSQL çŠ¶æ€ï¼š
   ```bash
   sudo systemctl status postgresql
   ```

2. æµ‹è¯•è¿æ¥ï¼š
   ```bash
   sudo -u postgres psql -d aigc_vault
   ```

3. æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼š
   ```bash
   cat backend/.env | grep DATABASE_URL
   ```

---

## ğŸ“ ç»´æŠ¤å»ºè®®

1. **å®šæœŸå¤‡ä»½æ•°æ®åº“**ï¼š
   ```bash
   pg_dump -U aigc_user -d aigc_vault > backup_$(date +%Y%m%d).sql
   ```

2. **ç›‘æ§ç£ç›˜ç©ºé—´**ï¼š
   - æ•°æ®åº“å¤§å°
   - RustFS å­˜å‚¨ç©ºé—´

3. **å®šæœŸæ›´æ–°ä¾èµ–**ï¼š
   - Python åŒ…ï¼š`pip list --outdated`
   - Node åŒ…ï¼š`npm outdated`

4. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
   - å›¾ç‰‡ç¼©ç•¥å›¾ç¼“å­˜
   - CDN åŠ é€Ÿï¼ˆå¯é€‰ï¼‰

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] PostgreSQL æ•°æ®åº“åˆ›å»ºå¹¶é…ç½®
- [ ] åç«¯ä»£ç éƒ¨ç½²å¹¶é…ç½®ç¯å¢ƒå˜é‡
- [ ] æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
- [ ] RustFS/S3 è¿æ¥æµ‹è¯•é€šè¿‡
- [ ] åç«¯æœåŠ¡å¯åŠ¨å¹¶è¿è¡Œ
- [ ] å‰ç«¯ä»£ç æ„å»ºæˆåŠŸ
- [ ] Nginx é…ç½®æ­£ç¡®
- [ ] HTTPS è¯ä¹¦é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] é˜²ç«å¢™é…ç½®
- [ ] æ—¥å¿—ç›‘æ§é…ç½®
- [ ] å¤‡ä»½ç­–ç•¥åˆ¶å®š

---

**éƒ¨ç½²å®Œæˆåï¼Œè®¿é—® `http://yourdomain.com` æˆ– `https://yourdomain.com` å³å¯ä½¿ç”¨ç³»ç»Ÿï¼**

